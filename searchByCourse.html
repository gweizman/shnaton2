<div class="row">
		<div id="validMaslulim">
			<span style="border: 3px dashed #ccc; padding: 10px; background: #fff; min-height: 100px; min-width: 200px;">Drag and drop here</span>
			<div id="selectedCourses"></div>
		</div>
		<div id="searchArea">
			<!-- There once was a form... -->
			<div id="searchResults"></div>
		</div>
		<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui.min.js"></script>
		<script type="text/javascript" src="js/shnatonApi.js"></script>
		<script>
		$(document).ready(function() {
			//add search stuff
			$('#search-bar').on("keyup", function(event) {
				var text = $(this).val();
				//clear previous results, except ones checked
				var kids = $('#searchResults').children();
				for (var i = 0; i < kids.length; i++) {
					if (!$(kids[i]).children().first().prop('checked')) {
						$(kids[i]).remove();
					}
				}
				// search for matching courses by name
				if (text.length > 2) {
					getJSON('GetCourseByName', { 'name': text }, function(obj) {
						for (var i = 0; i < obj.length; i++) {
							var name = obj[i].name;
							var id = obj[i].id;
							if ($('#' + id).length == 0) {
								$('<label id="' + id + '">' + name + '</label>').appendTo($('#searchResults')).hide().draggable({revert: "invalid"});
								$('#' + id).fadeIn();
							}
						}
					});
				}
			});
			
			//filter by selected courses
			$('#validMaslulim').droppable({
				accept: 'label',
				drop: function(event, ui) {
					var item = ui.draggable.draggable('disable').removeAttr('style').addClass('button');
					item.appendTo('#selectedCourses');
					$('<a class="close">&times;</a>').on("click", function(event) {
						$(this).parent().remove();
					}).prependTo($(item));
					searchMaslulByCourseIds();
					if ($('#selectedCourses').children().length == 2) {
						$(this).droppable("disable");
					}
				}
			});
			
			$('label > a.close').on("click", function(event) {
				searchMaslulByCourseIds();
			});
			
			function searchMaslulByCourseIds() {
				var kids = $('#selectedCourses').children();
					var ids = [];
					for (var i = 0; i < kids.length; i++) {
						ids[ids.length] = $(kids[i]).attr('id');
					}
					ids[ids.length] = null; //add another field, null, just in case.
				getJSON("Get2Masluls", { "courseId": ids[0], "courseId2": ids[1] }, function(obj) {
					console.log(obj);
				});
			}
		});
		</script>
</div>
